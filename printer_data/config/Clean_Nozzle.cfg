[gcode_macro CLEAN_NOZZLE]
variable_start_x: 154
variable_start_y: 350
variable_start_z: 8
variable_wipe_qty: 10
variable_wipe_spd: 200
variable_raise_distance: 30
variable_random_range_x: 10
variable_random_range_y: 5

gcode:
 {% if "xyz" not in printer.toolhead.homed_axes %}
   G28
 {% endif %}

 G90 ; absolute positioning

 G1 X{start_x} Y{start_y} F6000
 G1 Z{start_z} F1500

 {% for i in range(1, (wipe_qty + 1)) %}
   {% set dir_x = 1 if i % 2 == 0 else -1 %}
   {% set dir_y = 1 if i % 3 == 0 else -1 %}
   {% set offset_x = (i * 3) % random_range_x %}
   {% set offset_y = (i * 2) % random_range_y %}
   {% set target_x = start_x + (offset_x * dir_x) %}
   {% set target_y = start_y + (offset_y * dir_y) %}
   G1 X{target_x} Y{target_y} F{wipe_spd * 60}
   G1 X{start_x} Y{start_y} F{wipe_spd * 60}
 {% endfor %}

 G1 Z{raise_distance}